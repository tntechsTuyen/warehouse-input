
function delay(callback, ms) {
  var timer = 0;
  return function() {
    var context = this, args = arguments;
    clearTimeout(timer);
    timer = setTimeout(function () {
      callback.apply(context, args);
    }, ms || 0);
  };
}

const store = {
    get: function(k){
        return sessionStorage.getItem(k);
    },
    set: function(k, v){
        sessionStorage.setItem(k, v);
    },
    remove: function(k){
        sessionStorage.removeItem(k);
    }
}

const image = {
    render: function(targetView, fileImage){
        var reader = new FileReader();
        reader.onload = function (e1) {
            $(targetView).attr("src", e1.target.result);
        }
        reader.readAsDataURL(fileImage);
    }
}

function changeSearchParam(params){
    var s = new URLSearchParams(window.location.search);
    var hash = location.hash;
    for(var k in params){
        (s.get(k) == null) ? s.append(k, params[k]) : s.set(k, params[k]);
    }
    return location.pathname+"?"+s.toString()+hash;
}

function getParams(par, def){
    var s = new URLSearchParams(window.location.search);
    return (s.get(par) == null) ? def : s.get(par);
}

function goPage(_page) {
    document.location.href = changeSearchParam({page: _page});
};

function generalPage(viewName){
    var obj = $(viewName);
    var page = obj.data("page") * 1;
    var count = obj.data("count") * 1;
    var limit = obj.data("limit") * 1;
    if(count < limit){
        //first page
        obj.append(`<button type="button" class="btn btn-white active" index="1">1</button>`)
    }else{
        var tmp = Math.ceil(count/limit);
        if(page != 1){
            obj.append(`<button type="button" class="btn btn-white" index="before"><</button>`)
            obj.find(`[index="before"]`).attr("onclick", `goPage(${page-1})`)
        }

        obj.append(`<button type="button" class="btn btn-white" index="1" onclick="goPage(1)">1</button>`)

        for(var i = 2; i <= tmp; i++){
            var html = `<button type="button" class="btn btn-white" onclick="goPage(${i})" index="${i}">${i}</button>`
            obj.append(html)
        }

        if(page != tmp){
            obj.append(`<button type="button" class="btn btn-white" index="after">></button>`)
            obj.find(`[index="after"]`).attr("onclick", `goPage(${page+1})`)
        }

        obj.find(`[index="${page}"]`).addClass("active");
        obj.find(`[index="${page}"]`).removeAttr("onclick");
    }
}

$(document).ready(function(){

    $('div[onload]').trigger('onload');
    
    $("input.onlynum").on("input",function(){
        var str = $(this).val();
        var lastChar = (str.length > 0) ? str.substring(str.length - 1)  : false ;
        if(!lastChar) return;
        if(isNaN(lastChar)) $(this).val(str.slice(0, -1)); 
    })

    $("form").submit(function(){
        $("#loader").removeClass("loaded");
    })
})